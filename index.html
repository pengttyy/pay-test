<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æ”¯ä»˜å®é“¾æ¥æµ‹è¯•</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .card { background: #f8f9fa; border-radius: 10px; padding: 20px; margin: 20px 0; }
        .btn { background: #1677ff; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 16px; cursor: pointer; }
        .btn:hover { background: #4096ff; }
        .result { padding: 15px; border-radius: 6px; margin: 10px 0; }
        .success { background: #f6ffed; border: 1px solid #b7eb8f; }
        .error { background: #fff2f0; border: 1px solid #ffccc7; }
        .tip { color: #666; font-size: 14px; margin-top: 5px; }
        .scheme-box { background: #fff; padding: 15px; border-radius: 6px; border: 1px solid #d9d9d9; overflow-x: auto; font-family: monospace; }
    </style>
</head>
<body>
    <h2>ğŸ’° æ”¯ä»˜å®é“¾æ¥æ‹‰èµ·æµ‹è¯•</h2>
    
    <div class="card">
        <h3>æµ‹è¯•é“¾æ¥</h3>
        <div class="scheme-box">
            alipays://platformapi/startApp?appId=10000007&actionType=route&qrcode=281666040090amlr2tmCi9g3CG9g28G30Ey4
        </div>
        
        <div style="margin-top: 20px;">
            <button class="btn" onclick="testAlipay()">
                ç‚¹å‡»æµ‹è¯•æ‹‰èµ·æ”¯ä»˜å®
            </button>
            <div class="tip">ç‚¹å‡»åä¼šè‡ªåŠ¨å°è¯•æ‰“å¼€æ”¯ä»˜å®</div>
        </div>
    </div>
    
    <div id="result" class="card" style="display: none;">
        <h3>æµ‹è¯•ç»“æœ</h3>
        <div id="resultContent"></div>
    </div>
    
    <div class="card">
        <h3>å¤‡é€‰æ–¹æ¡ˆ</h3>
        <button class="btn" onclick="testAlternative()" style="background: #52c41a;">
            å¤‡ç”¨æ–¹æ¡ˆæµ‹è¯•
        </button>
        <button class="btn" onclick="generateQRCode()" style="background: #722ed1;">
            ç”Ÿæˆæµ‹è¯•äºŒç»´ç 
        </button>
        <button class="btn" onclick="copyLink()" style="background: #fa8c16;">
            å¤åˆ¶é“¾æ¥
        </button>
    </div>
    
    <div id="qrcodeContainer" class="card" style="display: none;">
        <h3>æµ‹è¯•äºŒç»´ç </h3>
        <div id="qrcode"></div>
        <div class="tip">ä½¿ç”¨æ”¯ä»˜å®æ‰«ä¸€æ‰«æ­¤äºŒç»´ç è¿›è¡Œæµ‹è¯•</div>
    </div>
    
    <script>
        // è¦æµ‹è¯•çš„é“¾æ¥
        const alipayLink = 'alipays://platformapi/startApp?appId=10000007&actionType=route&qrcode=281666040090amlr2tmCi9g3CG9g28G30Ey4';
        
        function showResult(message, isSuccess) {
            const resultEl = document.getElementById('result');
            const contentEl = document.getElementById('resultContent');
            
            contentEl.innerHTML = `<div class="result ${isSuccess ? 'success' : 'error'}">${message}</div>`;
            resultEl.style.display = 'block';
            resultEl.scrollIntoView({ behavior: 'smooth' });
        }
        
        function testAlipay() {
            showResult('æ­£åœ¨å°è¯•æ‹‰èµ·æ”¯ä»˜å®...', true);
            
            // è®°å½•å¼€å§‹æ—¶é—´
            const startTime = Date.now();
            let pageHidden = false;
            
            // ç›‘å¬é¡µé¢éšè—äº‹ä»¶ï¼ˆè·³è½¬åˆ°æ”¯ä»˜å®æ—¶é¡µé¢ä¼šéšè—ï¼‰
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    pageHidden = true;
                    const elapsed = Date.now() - startTime;
                    showResult(`âœ… æˆåŠŸæ‹‰èµ·æ”¯ä»˜å® (${elapsed}ms)<br>é¡µé¢å·²éšè—ï¼Œæ­£åœ¨è·³è½¬...`, true);
                }
            });
            
            // å°è¯•ç›´æ¥æ‰“å¼€æ”¯ä»˜å®
            window.location.href = alipayLink;
            
            // æ£€æŸ¥æ˜¯å¦æˆåŠŸï¼ˆ3ç§’åå¦‚æœé¡µé¢è¿˜æ²¡éšè—ï¼Œè¯´æ˜å¤±è´¥ï¼‰
            setTimeout(() => {
                if (!pageHidden) {
                    const elapsed = Date.now() - startTime;
                    showResult(
                        `âŒ æ‹‰èµ·å¤±è´¥ (${elapsed}ms)<br><br>
                        <strong>å¯èƒ½åŸå› ï¼š</strong><br>
                        1. æœªå®‰è£…æ”¯ä»˜å®App<br>
                        2. æµè§ˆå™¨é˜»æ­¢äº†è·³è½¬<br>
                        3. é“¾æ¥æ ¼å¼ä¸è¢«æ”¯æŒ<br><br>
                        <strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>
                        1. è¯·ç¡®ä¿å·²å®‰è£…æ”¯ä»˜å®<br>
                        2. å°è¯•ä½¿ç”¨ä¸‹æ–¹çš„å¤‡ç”¨æ–¹æ¡ˆ<br>
                        3. ä½¿ç”¨æ”¯ä»˜å®æ‰«ç äºŒç»´ç æµ‹è¯•`, 
                        false
                    );
                }
            }, 3000);
        }
        
        function testAlternative() {
            // å¤‡ç”¨æ–¹æ¡ˆï¼šé€šè¿‡æ”¯ä»˜å®å®˜æ–¹ä¸­é—´é¡µ
            const encodedLink = encodeURIComponent(alipayLink);
            const fallbackUrl = `https://ds.alipay.com/?from=mobilecodec&scheme=${encodedLink}`;
            
            showResult('æ­£åœ¨é€šè¿‡æ”¯ä»˜å®ä¸­é—´é¡µè·³è½¬...', true);
            window.open(fallbackUrl, '_blank');
        }
        
        function generateQRCode() {
            const container = document.getElementById('qrcodeContainer');
            const qrcodeDiv = document.getElementById('qrcode');
            
            // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
            qrcodeDiv.innerHTML = '';
            
            // ç”ŸæˆäºŒç»´ç 
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(alipayLink)}`;
            
            const img = document.createElement('img');
            img.src = qrUrl;
            img.alt = 'æ”¯ä»˜å®æµ‹è¯•äºŒç»´ç ';
            img.style.border = '1px solid #eee';
            img.style.padding = '10px';
            img.style.background = 'white';
            
            qrcodeDiv.appendChild(img);
            container.style.display = 'block';
            container.scrollIntoView({ behavior: 'smooth' });
            
            showResult('âœ… äºŒç»´ç å·²ç”Ÿæˆï¼Œè¯·ä½¿ç”¨æ”¯ä»˜å®æ‰«ä¸€æ‰«æµ‹è¯•', true);
        }
        
        function copyLink() {
            navigator.clipboard.writeText(alipayLink).then(() => {
                showResult('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', true);
            }).catch(err => {
                // å…¼å®¹æ—§æµè§ˆå™¨
                const textArea = document.createElement('textarea');
                textArea.value = alipayLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showResult('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', true);
            });
        }
        
        // è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ
        window.onload = function() {
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            const isAlipay = navigator.userAgent.includes('AlipayClient');
            
            let envInfo = '';
            if (isAlipay) {
                envInfo = 'ğŸ“± æ£€æµ‹åˆ°æ‚¨åœ¨æ”¯ä»˜å®å†…ç½®æµè§ˆå™¨ä¸­';
            } else if (isMobile) {
                envInfo = 'ğŸ“± æ£€æµ‹åˆ°æ‚¨åœ¨æ‰‹æœºæµè§ˆå™¨ä¸­';
            } else {
                envInfo = 'ğŸ’» æ£€æµ‹åˆ°æ‚¨åœ¨ç”µè„‘æµè§ˆå™¨ä¸­ï¼Œè¯·ä½¿ç”¨æ‰‹æœºæµ‹è¯•';
            }
            
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = `
                <h3>ç¯å¢ƒæ£€æµ‹</h3>
                <div class="result success">${envInfo}</div>
                <div class="tip">ç”¨æˆ·ä»£ç†: ${navigator.userAgent.substring(0, 100)}...</div>
            `;
            resultEl.style.display = 'block';
        };
    </script>
</body>
</html>